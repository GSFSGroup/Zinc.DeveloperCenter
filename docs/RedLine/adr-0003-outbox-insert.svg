<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="860px" preserveAspectRatio="none" style="width:935px;height:860px;" version="1.1" viewBox="0 0 935 860" width="935px" zoomAndPan="magnify"><defs><filter height="300%" id="f1ednb80y9ehlw" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1ednb80y9ehlw)" height="672.8203" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="68" y="96.4297"/><rect fill="#FFFFFF" filter="url(#f1ednb80y9ehlw)" height="20.1641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="249" y="135.5625"/><rect fill="#FFFFFF" filter="url(#f1ednb80y9ehlw)" height="83.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="249" y="184.8594"/><rect fill="#FFFFFF" filter="url(#f1ednb80y9ehlw)" height="25" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="254" y="221.9922"/><rect fill="#FFFFFF" filter="url(#f1ednb80y9ehlw)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="249" y="423.6563"/><rect fill="#FFFFFF" filter="url(#f1ednb80y9ehlw)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="249" y="481.9219"/><rect fill="#FFFFFF" filter="url(#f1ednb80y9ehlw)" height="426.8594" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="481" y="351.3906"/><rect fill="#FFFFFF" filter="url(#f1ednb80y9ehlw)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="624" y="380.5234"/><rect fill="#FFFFFF" filter="url(#f1ednb80y9ehlw)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="755.5" y="741.25"/><rect fill="#FFFFFF" filter="url(#f1ednb80y9ehlw)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="868" y="525.0547"/><rect fill="#FFFFFF" filter="url(#f1ednb80y9ehlw)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="868" y="583.3203"/><rect fill="#FEFECE" filter="url(#f1ednb80y9ehlw)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="208" x="148" y="104.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="194" x="155" y="124.4248">aggregate1: AggregateRoot</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="73" x2="73" y1="65.2969" y2="787.25"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="254" x2="254" y1="137.0781" y2="787.25"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="486" x2="486" y1="65.2969" y2="787.25"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="628.5" x2="628.5" y1="65.2969" y2="787.25"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="760.5" x2="760.5" y1="65.2969" y2="787.25"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="872.5" x2="872.5" y1="65.2969" y2="787.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="124" x="8" y="61.9951">CommandHandler</text><ellipse cx="73" cy="33" fill="#FEFECE" filter="url(#f1ednb80y9ehlw)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="69,21,75,16,73,21,75,26,69,21" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="124" x="8" y="799.2451">CommandHandler</text><ellipse cx="73" cy="818.5469" fill="#FEFECE" filter="url(#f1ednb80y9ehlw)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="69,806.5469,75,801.5469,73,806.5469,75,811.5469,69,806.5469" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1ednb80y9ehlw)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="208" x="148" y="786.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="194" x="155" y="806.2451">aggregate1: AggregateRoot</text><rect fill="#FEFECE" filter="url(#f1ednb80y9ehlw)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="88" x="440" y="30"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="447" y="49.9951">Repository</text><rect fill="#FEFECE" filter="url(#f1ednb80y9ehlw)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="88" x="440" y="786.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="447" y="806.2451">Repository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="554.5" y="61.9951">AggregateRootTable</text><path d="M611,13 C611,3 629,3 629,3 C629,3 647,3 647,13 L647,39 C647,49 629,49 629,49 C629,49 611,49 611,39 L611,13 " fill="#FEFECE" filter="url(#f1ednb80y9ehlw)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M611,13 C611,23 629,23 629,23 C629,23 647,23 647,13 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="554.5" y="799.2451">AggregateRootTable</text><path d="M611,812.5469 C611,802.5469 629,802.5469 629,802.5469 C629,802.5469 647,802.5469 647,812.5469 L647,838.5469 C647,848.5469 629,848.5469 629,848.5469 C629,848.5469 611,848.5469 611,838.5469 L611,812.5469 " fill="#FEFECE" filter="url(#f1ednb80y9ehlw)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M611,812.5469 C611,822.5469 629,822.5469 629,822.5469 C629,822.5469 647,822.5469 647,812.5469 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="713.5" y="61.9951">OutboxTable</text><path d="M742.5,13 C742.5,3 760.5,3 760.5,3 C760.5,3 778.5,3 778.5,13 L778.5,39 C778.5,49 760.5,49 760.5,49 C760.5,49 742.5,49 742.5,39 L742.5,13 " fill="#FEFECE" filter="url(#f1ednb80y9ehlw)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M742.5,13 C742.5,23 760.5,23 760.5,23 C760.5,23 778.5,23 778.5,13 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="713.5" y="799.2451">OutboxTable</text><path d="M742.5,812.5469 C742.5,802.5469 760.5,802.5469 760.5,802.5469 C760.5,802.5469 778.5,802.5469 778.5,812.5469 L778.5,838.5469 C778.5,848.5469 760.5,848.5469 760.5,848.5469 C760.5,848.5469 742.5,848.5469 742.5,838.5469 L742.5,812.5469 " fill="#FEFECE" filter="url(#f1ednb80y9ehlw)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M742.5,812.5469 C742.5,822.5469 760.5,822.5469 760.5,822.5469 C760.5,822.5469 778.5,822.5469 778.5,812.5469 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f1ednb80y9ehlw)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="107" x="817.5" y="30"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="824.5" y="49.9951">RequestContext</text><rect fill="#FEFECE" filter="url(#f1ednb80y9ehlw)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="107" x="817.5" y="786.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="824.5" y="806.2451">RequestContext</text><rect fill="#FFFFFF" filter="url(#f1ednb80y9ehlw)" height="672.8203" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="68" y="96.4297"/><rect fill="#FFFFFF" filter="url(#f1ednb80y9ehlw)" height="20.1641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="249" y="135.5625"/><rect fill="#FFFFFF" filter="url(#f1ednb80y9ehlw)" height="83.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="249" y="184.8594"/><rect fill="#FFFFFF" filter="url(#f1ednb80y9ehlw)" height="25" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="254" y="221.9922"/><rect fill="#FFFFFF" filter="url(#f1ednb80y9ehlw)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="249" y="423.6563"/><rect fill="#FFFFFF" filter="url(#f1ednb80y9ehlw)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="249" y="481.9219"/><rect fill="#FFFFFF" filter="url(#f1ednb80y9ehlw)" height="426.8594" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="481" y="351.3906"/><rect fill="#FFFFFF" filter="url(#f1ednb80y9ehlw)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="624" y="380.5234"/><rect fill="#FFFFFF" filter="url(#f1ednb80y9ehlw)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="755.5" y="741.25"/><rect fill="#FFFFFF" filter="url(#f1ednb80y9ehlw)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="868" y="525.0547"/><rect fill="#FFFFFF" filter="url(#f1ednb80y9ehlw)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="868" y="583.3203"/><polygon fill="#A80036" points="56,92.4297,66,96.4297,56,100.4297,60,96.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3" x2="62" y1="96.4297" y2="96.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="45" x="10" y="91.3638">Handle</text><polygon fill="#A80036" points="136,121.5625,146,125.5625,136,129.5625,140,125.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="78" x2="142" y1="125.5625" y2="125.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="25" x="85" y="120.4966">new</text><rect fill="#FEFECE" filter="url(#f1ednb80y9ehlw)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="208" x="148" y="104.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="194" x="155" y="124.4248">aggregate1: AggregateRoot</text><polygon fill="#A80036" points="89,151.7266,79,155.7266,89,159.7266,85,155.7266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="83" x2="253" y1="155.7266" y2="155.7266"/><polygon fill="#A80036" points="237,180.8594,247,184.8594,237,188.8594,241,184.8594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="78" x2="243" y1="184.8594" y2="184.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="85" y="179.7935">Change state</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="259" x2="306" y1="208.9922" y2="208.9922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="306" x2="306" y1="208.9922" y2="221.9922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="265" x2="306" y1="221.9922" y2="221.9922"/><polygon fill="#A80036" points="275,217.9922,265,221.9922,275,225.9922,271,221.9922" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="271" y="203.9263">PublishEvent(aggregateCreated)</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="264" x2="306" y1="245.9922" y2="245.9922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="306" x2="306" y1="245.9922" y2="258.9922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="259" x2="306" y1="258.9922" y2="258.9922"/><polygon fill="#A80036" points="269,254.9922,259,258.9922,269,262.9922,265,258.9922" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="89,263.9922,79,267.9922,89,271.9922,85,267.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="83" x2="253" y1="267.9922" y2="267.9922"/><path d="M259,280.9922 L259,320.9922 L447,320.9922 L447,290.9922 L437,280.9922 L259,280.9922 " fill="#FBFB77" filter="url(#f1ednb80y9ehlw)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M437,280.9922 L437,290.9922 L447,290.9922 L437,280.9922 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="265" y="298.0591">Pushes aggregateCreated</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="265" y="313.1919">to Events queue.</text><polygon fill="#A80036" points="469,347.3906,479,351.3906,469,355.3906,473,351.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="78" x2="475" y1="351.3906" y2="351.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="85" y="346.3247">Save(aggregate1)</text><polygon fill="#A80036" points="612,376.5234,622,380.5234,612,384.5234,616,380.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="491" x2="618" y1="380.5234" y2="380.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="498" y="375.4575">Insert aggregate1</text><polygon fill="#A80036" points="502,390.5234,492,394.5234,502,398.5234,498,394.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="496" x2="628" y1="394.5234" y2="394.5234"/><polygon fill="#A80036" points="270,419.6563,260,423.6563,270,427.6563,266,423.6563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="264" x2="480" y1="423.6563" y2="423.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="276" y="418.5903">get Events</text><polygon fill="#A80036" points="469,448.7891,479,452.7891,469,456.7891,473,452.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="254" x2="475" y1="452.7891" y2="452.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="261" y="447.7231">events</text><polygon fill="#A80036" points="270,477.9219,260,481.9219,270,485.9219,266,481.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="264" x2="480" y1="481.9219" y2="481.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="276" y="476.856">PurgeEvents()</text><polygon fill="#A80036" points="469,491.9219,479,495.9219,469,499.9219,473,495.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="254" x2="475" y1="495.9219" y2="495.9219"/><polygon fill="#A80036" points="856,521.0547,866,525.0547,856,529.0547,860,525.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="491" x2="862" y1="525.0547" y2="525.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="498" y="519.9888">get CorrelationId</text><polygon fill="#A80036" points="502,550.1875,492,554.1875,502,558.1875,498,554.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="496" x2="872" y1="554.1875" y2="554.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="508" y="549.1216">CorrelationId</text><polygon fill="#A80036" points="856,579.3203,866,583.3203,856,587.3203,860,583.3203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="491" x2="862" y1="583.3203" y2="583.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="498" y="578.2544">get TenantId</text><polygon fill="#A80036" points="502,608.4531,492,612.4531,502,616.4531,498,612.4531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="496" x2="872" y1="612.4531" y2="612.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="508" y="607.3872">TenantId</text><path d="M582,625.4531 L582,710.4531 L751,710.4531 L751,635.4531 L741,625.4531 L582,625.4531 " fill="#FBFB77" filter="url(#f1ednb80y9ehlw)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M741,625.4531 L741,635.4531 L751,635.4531 L741,625.4531 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="588" y="642.52">message_headers: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="604" y="657.6528">correlationId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="604" y="672.7856">tenantId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="588" y="687.9185">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="588" y="703.0513">message_body: events</text><polygon fill="#A80036" points="743.5,737.25,753.5,741.25,743.5,745.25,747.5,741.25" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="491" x2="749.5" y1="741.25" y2="741.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="498" y="736.1841">Insert events</text><polygon fill="#A80036" points="502,751.25,492,755.25,502,759.25,498,755.25" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="496" x2="759.5" y1="755.25" y2="755.25"/><polygon fill="#A80036" points="14,765.25,4,769.25,14,773.25,10,769.25" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="8" x2="72" y1="769.25" y2="769.25"/><!--
@startuml Outbox-Insert
autoactivate on

control CommandHandler
participant AggregateRoot as "aggregate1: AggregateRoot"
participant Repository
database AggregateRootTable
database OutboxTable

[-> CommandHandler: Handle

create AggregateRoot
CommandHandler -> AggregateRoot: new
return

CommandHandler -> AggregateRoot: Change state

AggregateRoot -> AggregateRoot : PublishEvent(aggregateCreated)
return
return

note right of AggregateRoot
    Pushes aggregateCreated
    to Events queue.
end note

CommandHandler -> Repository: Save(aggregate1)

Repository -> AggregateRootTable: Insert aggregate1
return

Repository -> AggregateRoot: get Events
return events

Repository -> AggregateRoot: PurgeEvents()
return

Repository -> RequestContext: get CorrelationId
return CorrelationId

Repository -> RequestContext: get TenantId
return TenantId

note left of OutboxTable
    message_headers: {
        correlationId,
        tenantId
    },
    message_body: events
end note

Repository -> OutboxTable: Insert events
return

[<- - CommandHandler

@enduml

PlantUML version 1.2019.09(Mon Aug 26 11:19:51 CDT 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 14-ea+18-Ubuntu-1
Operating System: Linux
OS Version: 5.3.0-46-generic
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>